<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Documentation For Package – Farm Precipitation &amp; Income Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-e31584831b205ffbb2d98406f31c2a5b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Farm Precipitation &amp; Income Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./documentation.html" aria-current="page"> 
<span class="menu-text">Documentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./tutorial.html"> 
<span class="menu-text">Tutorial</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./technicalwriteup.html"> 
<span class="menu-text">Technical Writeup</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#sources" id="toc-sources" class="nav-link" data-scroll-target="#sources">Sources</a></li>
  <li><a href="#file-descriptions" id="toc-file-descriptions" class="nav-link" data-scroll-target="#file-descriptions">File Descriptions</a></li>
  <li><a href="#combined-data-file" id="toc-combined-data-file" class="nav-link" data-scroll-target="#combined-data-file">Combined Data File</a></li>
  </ul></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a>
  <ul class="collapse">
  <li><a href="#precipitationpdsi-data-preparation" id="toc-precipitationpdsi-data-preparation" class="nav-link" data-scroll-target="#precipitationpdsi-data-preparation">Precipitation/PDSI Data Preparation</a></li>
  <li><a href="#farm-data-preparation" id="toc-farm-data-preparation" class="nav-link" data-scroll-target="#farm-data-preparation">Farm Data Preparation</a></li>
  <li><a href="#combining-data" id="toc-combining-data" class="nav-link" data-scroll-target="#combining-data">Combining data</a></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</a></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Documentation For Package</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="data" class="level1">
<h1>Data</h1>
<section id="sources" class="level3">
<h3 class="anchored" data-anchor-id="sources">Sources</h3>
<p><a href="https://www.ncei.noaa.gov/pub/data/cirs/drd/drd964x.pdsi.txt">Precipitation</a> - NOAA (National Oceanic and Atmospheric Administration). This data uses the PDSI metric. Which is an indicator of how much water is available compared to the average amount of water normally available in that region. It factors in precipitation, temperature, and soil moisture. This data tells us the monthly PDSI of each region of each state for each year. It is reasonable to average across regions, because for each state the regions are roughy equal in size.</p>
<p><a href="https://data.ers.usda.gov/reports.aspx?ID=4047#Pae6cc0e926f6455896ee3f109f3b7f51_14_109iT0R0x43">Farm Income</a> - USDA (United States Department of Agriculture). This website contains an excel spreadsheet that can be downloaded. This excel file contians a sheet for each state. Each state’s sheet contains a column per year where each row contains dollar values for different parts of a State’s agricultural profits. It includes crop, livestock, and expense data among other things.</p>
</section>
<section id="file-descriptions" class="level3">
<h3 class="anchored" data-anchor-id="file-descriptions">File Descriptions</h3>
<p>The Precipitation dataset is a .txt file. It’s first column contains a code for the state, division, element (in this case PDSI), and year. It then contains a column for each month, which contains the PDSI value for that month.</p>
<p>An example row from the txt file: <!-- ```{python}
import pandas as pd
print(pd.read_fwf("rain.txt").head(1).to_markdown())
``` --></p>
<div class="line-block">0101051895 | 0.11 | -0.81 | -0.56 | -0.72 | -0.85 | -0.99 | -0.90 | -1.13 | -1.69 | -1.72 | -2.04 | -2.12 |</div>
<p>State code = 01 (which corresponds to a state) Division number = 01 (first climate division in Florida) Element code = 05 (PDSI) Year = 1895 January PDSI value = 0.11 February PDSI value = -0.81 March PDSI value = -0.56 … and so forth through December.</p>
<p>The Farm Income dataset is an .xlsx file made up of several sheets, one for each state as well as informational guides. It contains rows of data separated by year in columns, containing income data across several different industry types. We chose to focus on food-type crops, found in the first block-like row section of each state sheet.</p>
<p>An example row from the text file:</p>
<div id="2a7644ba" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import pandas as pd</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # read the "Alabama" sheet and show the first few rows</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># df = pd.read_excel("VA_State_US (1).xlsx", sheet_name="Alabama")</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df[5,].to_markdown())</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="combined-data-file" class="level3">
<h3 class="anchored" data-anchor-id="combined-data-file">Combined Data File</h3>
<p>The combined dataset contains information from both datasets joined on the state and the year. It provides PDSI averages for the state along with the state’s to total income, and income by crop category. An example row of the data is included below.</p>
<div id="5e76c1df" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.read_csv(<span class="st">"combined_farm_precip.csv"</span>).head(<span class="dv">1</span>).to_markdown())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>|    |   state |   year |   Value of crop production |   Crop cash receipts |   Cotton |   Feed crops |   Food grains |   Fruits and nuts |   Oil crops |   Vegetables and melons |   All other crops |   Home consumption |   Inventory adjustment |   yearly_avg |
|---:|--------:|-------:|---------------------------:|---------------------:|---------:|-------------:|--------------:|------------------:|------------:|------------------------:|------------------:|-------------------:|-----------------------:|-------------:|
|  0 |       1 |   1949 |                     250813 |               230275 |   150706 |        13405 |           231 |              4937 |       30196 |                   14421 |             16238 |              39680 |                 -19142 |      1.18625 |</code></pre>
</div>
</div>
</section>
</section>
<section id="functions" class="level1">
<h1>Functions</h1>
<section id="precipitationpdsi-data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="precipitationpdsi-data-preparation">Precipitation/PDSI Data Preparation</h3>
<p>These functions will use a url file to produce write multiple files. The raw output from the url to a txt and csv file. It then produces a table that provides the average PDSI per state per year and writes it to a csv.</p>
<ul>
<li><strong>read_url_txt(url, txt_name, csv_name, colspecs, cols)</strong></li>
</ul>
<p>Overview:</p>
<p>Input is a url containing a .txt file. Uses requests package to have requests.get output. Saves a .csv file and uses txt_to_csv() (see below) to save .txt file of dataset. Calls <em>txt_to_csv</em> as part of process.</p>
<p>Args:</p>
<p><em>url</em>:str - a url pointing to a remote .txt file. (“https://www.ncei.noaa.gov/pub/data/cirs/drd/drd964x.pdsi.txt”) <em>txt_name</em>:str - the name the .txt file will be saved to. (“name.txt”) <em>csv_name</em>:str - the name the .csv file will be saved to. (“name.csv”) <em>col_specs</em>:list - contains tuples that indicate how to break string into parts. Must be same length as <em>cols</em>.([(0, 2), (2, 4), (4, 6), (6, 10),(10, 17)]) <em>cols</em>:list - contains names of new columns that are created with col_specs. Must be same length as <em>col_specs</em>. (cols = [“col1”, “col2”, “col3”, “col4”,“col5”])</p>
<p>Impact: Returns None. This function will write files, but will not return anything.</p>
<ul>
<li><strong>txt_to_csv(txt_name, csv_name, colspecs, cols)</strong></li>
</ul>
<p>Overview:</p>
<p>Reads txt file. Parses government coding system from first column into various columns. Converts strings cells containing PDSI information to numeric values, Writes new broken up table to csv.</p>
<p>Args: <em>txt_name</em>:str - the name the .txt file will be saved to. (“name.txt”) <em>csv_name</em>:str - the name the .csv file will be saved to. (“name.csv”) <em>col_specs</em>:list - contains tuples that indicate how to break string into parts. Must be same length as <em>cols</em>.([(0, 2), (2, 4), (4, 6), (6, 10),(10, 17)]) <em>cols</em>:list - contains names of new columns that are created with col_specs. Must be same length as <em>col_specs</em>. (cols = [“col1”, “col2”, “col3”, “col4”,“col5”])</p>
<p>Impact: Returns None. This function will write files, but will not return anything.</p>
<p>Example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> read_url_txt, txt_to_csv</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://www.ncei.noaa.gov/pub/data/cirs/drd/drd964x.pdsi.txt"</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>txt_name <span class="op">=</span> <span class="st">"rain.txt"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>csv_name <span class="op">=</span> <span class="st">"rain_dirty.csv"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>colspecs <span class="op">=</span> [</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>, <span class="dv">2</span>), (<span class="dv">2</span>, <span class="dv">4</span>), (<span class="dv">4</span>, <span class="dv">6</span>), (<span class="dv">6</span>, <span class="dv">10</span>),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">10</span>, <span class="dv">17</span>), (<span class="dv">17</span>, <span class="dv">24</span>), (<span class="dv">24</span>, <span class="dv">31</span>), (<span class="dv">31</span>, <span class="dv">38</span>),</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">38</span>, <span class="dv">45</span>), (<span class="dv">45</span>, <span class="dv">52</span>), (<span class="dv">52</span>, <span class="dv">59</span>), (<span class="dv">59</span>, <span class="dv">66</span>),</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">66</span>, <span class="dv">73</span>), (<span class="dv">73</span>, <span class="dv">80</span>), (<span class="dv">80</span>, <span class="dv">87</span>), (<span class="dv">87</span>, <span class="dv">94</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state"</span>, <span class="st">"division"</span>, <span class="st">"element"</span>, <span class="st">"year"</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"jan"</span>,<span class="st">"feb"</span>,<span class="st">"mar"</span>,<span class="st">"apr"</span>,<span class="st">"may"</span>,<span class="st">"jun"</span>,<span class="st">"jul"</span>,<span class="st">"aug"</span>,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sep"</span>,<span class="st">"oct"</span>,<span class="st">"nov"</span>,<span class="st">"dec"</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>read_url_txt(url, txt_name, csv_name, colspecs, cols)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.read_csv(csv_name).head(<span class="dv">1</span>).to_markdown())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><strong>normalized_data(df, months, groups, csv_name_clean, new_col_name)</strong></li>
</ul>
<p>Overview: Averages the PDSI across months for each row, and saves it as a new column. This is the yearly average PDSI for each district of each state. Creates a new table averaging the yearly PDSI for every state across all its districts. Writes the table to a csv.</p>
<p>Args: <em>df_to_read</em>:str - contains name of csv to read. <em>new_col_name</em>:str - name of new column that is added when calculating average for each row. <em>csv_name_clean</em>:str - name of csv you want to save your calculated table to. (“averaged_vals.csv”) <em>months</em>:list - contains strings of values that will be used to calculate the averages for each row. ([“col1”,“col2”,“col3”]) <em>groups</em>:list - contains strings of values to group by when calculating averages across rows. ([“group1”, “group2”])</p>
<p>Impact: Returns None. This function will write files, but will not return anything.</p>
<p>Example:</p>
<div id="09ea0b62" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> normalized_data</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>months <span class="op">=</span> [<span class="st">"jan"</span>,<span class="st">"feb"</span>,<span class="st">"mar"</span>,<span class="st">'apr'</span>,<span class="st">"may"</span>,<span class="st">"jun"</span>,<span class="st">"jul"</span>,<span class="st">"aug"</span>,<span class="st">"sep"</span>,<span class="st">"oct"</span>,<span class="st">"nov"</span>,<span class="st">"dec"</span>]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>groups <span class="op">=</span> [<span class="st">"state"</span>,<span class="st">"year"</span>]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>new_col_name <span class="op">=</span> <span class="st">"yearly_avg"</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>csv_name_clean <span class="op">=</span> <span class="st">"rain_clean.csv"</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>df_to_read <span class="op">=</span> <span class="st">"rain_dirty.csv"</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>normalized_data(df_to_read, new_col_name, csv_name_clean, months, groups)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.read_csv(csv_name_clean).head(<span class="dv">1</span>).to_markdown())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>|    |   state |   year |   yearly_avg |
|---:|--------:|-------:|-------------:|
|  0 |       1 |   1895 |    -0.821354 |</code></pre>
</div>
</div>
</section>
<section id="farm-data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="farm-data-preparation">Farm Data Preparation</h3>
<p>These functions extract and standardize farm income and crop-category data from historical USDA Excel workbooks. The workflow converts wide, state-specific tables into a tidy format with one row per state per year, matching the structure of <code>FarmIncome.xlsx</code>. The cleaned output is written to a CSV file for direct merging with the PDSI dataset.</p>
<hr>
<section id="utility-functions" class="level4">
<h4 class="anchored" data-anchor-id="utility-functions">Utility Functions</h4>
<ul>
<li><strong>row_by_label(df, label)</strong></li>
</ul>
<p><strong>Overview:</strong><br>
Finds the first row in a DataFrame whose first column exactly matches a specified text label. This is used to locate crop-category rows (e.g., <em>Cotton</em>, <em>Food grains</em>) in the VA workbook sheets.</p>
<p><strong>Args:</strong><br>
- <em>df</em>: pd.DataFrame — DataFrame read from an Excel sheet<br>
- <em>label</em>: str — row label to search for in the first column</p>
<p><strong>Impact:</strong><br>
Returns a pandas Series for the matched row, or <code>None</code> if the label is not found. This function does not write files.</p>
<hr>
</section>
<section id="farm-data-extraction" class="level4">
<h4 class="anchored" data-anchor-id="farm-data-extraction">Farm Data Extraction</h4>
<ul>
<li><strong>extract_state_rows(va_path, sheet_name, state_id, years_needed)</strong></li>
</ul>
<p><strong>Overview:</strong><br>
Extracts crop-related income values for a single state from the VA workbook and returns a standardized table with one row per year. The function maps Excel year headers to columns, pulls relevant crop-category rows, and formats the results to match the structure of <code>FarmIncome.xlsx</code>.</p>
<p><strong>Args:</strong><br>
- <em>va_path</em>: str — path to the VA workbook<br>
- <em>sheet_name</em>: str — name of the Excel sheet corresponding to the state<br>
- <em>state_id</em>: int — numeric identifier for the state (1–48)<br>
- <em>years_needed</em>: list[int] — years to extract</p>
<p><strong>Impact:</strong><br>
Returns a pd.DataFrame containing: - <code>state</code>, <code>year</code> - <code>Value of crop production</code> - <code>Crop cash receipts</code> - <code>Cotton</code> - <code>Feed crops</code> - <code>Food grains</code> - <code>Fruits and nuts</code> - <code>Oil crops</code> - <code>Vegetables and melons</code> - <code>All other crops</code> - <code>Home consumption</code> - <code>Inventory adjustment</code></p>
<p>No files are written by this function.</p>
<hr>
</section>
<section id="full-farm-dataset-construction" class="level4">
<h4 class="anchored" data-anchor-id="full-farm-dataset-construction">Full Farm Dataset Construction</h4>
<ul>
<li><strong>scrape_farm_data()</strong></li>
</ul>
<p><strong>Overview:</strong><br>
Builds a complete farm income dataset for all 48 contiguous U.S. states by looping through each state sheet in the VA workbook, extracting standardized crop data, and combining the results into a single tidy table.</p>
<p>Key steps: 1. Reads <code>FarmIncome.xlsx</code> to obtain the target years and column order<br>
2. Assigns numeric state IDs (1–48) in alphabetical order<br>
3. Extracts yearly crop data for each state using <code>extract_state_rows</code><br>
4. Concatenates, sorts, and aligns all state data<br>
5. Writes the final dataset to a CSV file</p>
<p><strong>Args:</strong><br>
None</p>
<p><strong>Impact:</strong><br>
Returns None. Writes the cleaned dataset to: - <strong><code>FarmIncome_full.csv</code></strong></p>
<hr>
</section>
<section id="example" class="level4">
<h4 class="anchored" data-anchor-id="example">Example</h4>
<div id="39354589" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> scrape_farm_data</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>scrape_farm_data()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Done. Wrote 3168 rows to FarmIncome_full.csv.</code></pre>
</div>
</div>
</section>
</section>
<section id="combining-data" class="level3">
<h3 class="anchored" data-anchor-id="combining-data">Combining data</h3>
<p>We created a function to merge two datasets on specific values and to save the merged data in a csv.</p>
<ul>
<li><strong>merge_csvs(new_csv_name, csvs, group_on)</strong></li>
</ul>
<p>Overview: Reads two .csv files. Merges the files on a set of columns. Writes the merged table to a .csv.</p>
<p>Args: <em>new_csv_name</em>:str Name to use for merged .csv file (“merged.csv”) <em>csvs</em>:list Contains two strings where each string is a .csv to be read and merged ([“tble1.csv”, “tble2.csv”]) <em>group_on</em>:list Contains strings where each string is a column to be grouped on ([“col1”, “col2”, “col3”])</p>
<p>Impact: Returns None. Writes a new .csv file</p>
<p>Example:</p>
<p>Starting csvs:</p>
<div id="f0afd247" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>csvs <span class="op">=</span> [<span class="st">"FarmIncome_full.csv"</span>, <span class="st">"rain_clean.csv"</span>]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.read_csv(csvs[<span class="dv">0</span>]).head(<span class="dv">1</span>).to_markdown())</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.read_csv(csvs[<span class="dv">1</span>]).head(<span class="dv">1</span>).to_markdown())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>|    |   state |   year |   Value of crop production |   Crop cash receipts |   Cotton |   Feed crops |   Food grains |   Fruits and nuts |   Oil crops |   Vegetables and melons |   All other crops |   Home consumption |   Inventory adjustment |
|---:|--------:|-------:|---------------------------:|---------------------:|---------:|-------------:|--------------:|------------------:|------------:|------------------------:|------------------:|-------------------:|-----------------------:|
|  0 |       1 |   1949 |                     250813 |               230275 |   150706 |        13405 |           231 |              4937 |       30196 |                   14421 |             16238 |              39680 |                 -19142 |
|    |   state |   year |   yearly_avg |
|---:|--------:|-------:|-------------:|
|  0 |       1 |   1895 |    -0.821354 |</code></pre>
</div>
</div>
<p>Merging them:</p>
<div id="f7c6b87b" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> merge_csvs</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>csvs <span class="op">=</span> [<span class="st">"FarmIncome_full.csv"</span>, <span class="st">"rain_clean.csv"</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>group_on <span class="op">=</span> [<span class="st">"state"</span>, <span class="st">"year"</span>]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>new_csv_name <span class="op">=</span> <span class="st">"combined_farm_precip.csv"</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>merge_csvs(new_csv_name, csvs, group_on)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.read_csv(new_csv_name).head(<span class="dv">1</span>).to_markdown())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>|    |   state |   year |   Value of crop production |   Crop cash receipts |   Cotton |   Feed crops |   Food grains |   Fruits and nuts |   Oil crops |   Vegetables and melons |   All other crops |   Home consumption |   Inventory adjustment |   yearly_avg |
|---:|--------:|-------:|---------------------------:|---------------------:|---------:|-------------:|--------------:|------------------:|------------:|------------------------:|------------------:|-------------------:|-----------------------:|-------------:|
|  0 |       1 |   1949 |                     250813 |               230275 |   150706 |        13405 |           231 |              4937 |       30196 |                   14421 |             16238 |              39680 |                 -19142 |      1.18625 |</code></pre>
</div>
</div>
</section>
<section id="exploratory-data-analysis-eda" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</h3>
<p>This section performs exploratory analysis on the merged precipitation–farm income dataset to validate data quality, summarize distributions, and visualize temporal and cross-sectional relationships between normalized precipitation (PDSI) and crop income. All figures are saved as high-resolution PNG files.</p>
<section id="data-loading" class="level4">
<h4 class="anchored" data-anchor-id="data-loading">Data Loading</h4>
<p>The combined dataset produced by merge_csvs() is read once and reused across all EDA functions.</p>
<div id="c23d9f92" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"combined_farm_precip.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>This dataset contains one row per state per year, including normalized precipitation (yearly_avg) and multiple farm income variables.</p>
</section>
<section id="summary-checks" class="level4">
<h4 class="anchored" data-anchor-id="summary-checks">Summary Checks</h4>
<p>basic_summary(df)</p>
<p>Provides a quick integrity check of the dataset by displaying sample rows, descriptive statistics, and missing-value counts.</p>
<div id="a4745456" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> basic_summary(df):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df.head())</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df.describe())</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df.isna().<span class="bu">sum</span>())</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>basic_summary(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   state  year  Value of crop production  Crop cash receipts    Cotton  \
0      1  1949                    250813              230275  150706.0   
1      1  1950                    267006              229713  130815.0   
2      1  1951                    292913              264151  177427.0   
3      1  1952                    298393              277208  189744.0   
4      1  1953                    331899              263726  180347.0   

   Feed crops  Food grains  Fruits and nuts  Oil crops  Vegetables and melons  \
0     13405.0        231.0           4937.0    30196.0                14421.0   
1     13510.0        245.0           4850.0    32003.0                12494.0   
2     14241.0        192.0           6245.0    23205.0                13414.0   
3      9517.0        268.0           5274.0    25783.0                20143.0   
4      9779.0        682.0           7388.0    24700.0                16534.0   

   All other crops  Home consumption  Inventory adjustment  yearly_avg  
0            16238             39680                -19142    1.186250  
1            35796             39254                 -2143   -0.492812  
2            29427             35748                 -7278   -1.152396  
3            26479             49808                -28897   -1.601042  
4            24296             46457                 21395   -0.649375  
             state         year  Value of crop production  Crop cash receipts  \
count  3168.000000  3168.000000              3.168000e+03        3.168000e+03   
mean     24.500000  1981.500000              1.473636e+06        1.470690e+06   
std      13.855586    19.053379              2.769639e+06        2.793789e+06   
min       1.000000  1949.000000              5.650000e+02        2.253000e+03   
25%      12.750000  1965.000000              2.175792e+05        2.086222e+05   
50%      24.500000  1981.500000              5.789210e+05        5.651050e+05   
75%      36.250000  1998.000000              1.692684e+06        1.666231e+06   
max      48.000000  2014.000000              4.026474e+07        4.156413e+07   

             Cotton    Feed crops   Food grains  Fruits and nuts  \
count  1.174000e+03  3.164000e+03  2.762000e+03     3.103000e+03   
mean   2.232031e+05  3.878076e+05  1.699410e+05     1.737764e+05   
std    3.318479e+05  9.674393e+05  2.858749e+05     1.046789e+06   
min    1.000000e+00  7.800000e+01  7.000000e+00     1.000000e+00   
25%    3.471475e+04  1.758300e+04  9.850500e+03     4.111000e+03   
50%    9.750950e+04  8.435900e+04  5.627450e+04     1.273900e+04   
75%    2.811865e+05  3.168780e+05  2.047168e+05     4.485600e+04   
max    2.926707e+06  1.346560e+07  2.568081e+06     2.338434e+07   

          Oil crops  Vegetables and melons  All other crops  Home consumption  \
count  2.389000e+03           3.106000e+03     3.168000e+03       3168.000000   
mean   3.384814e+05           1.856867e+05     2.069825e+05       5582.379735   
std    6.801232e+05           6.251124e+05     4.841141e+05       7164.140540   
min    1.000000e+00           3.500000e+01     1.450000e+02         42.000000   
25%    1.223000e+04           1.300925e+04     2.193900e+04       1140.750000   
50%    7.950900e+04           4.281200e+04     5.448850e+04       3141.500000   
75%    3.121970e+05           1.260885e+05     1.949538e+05       7235.500000   
max    6.359326e+06           8.306708e+06     6.188771e+06      70132.000000   

       Inventory adjustment   yearly_avg  
count          3.168000e+03  3168.000000  
mean          -2.613662e+03    -1.204919  
std            2.572786e+05    11.339128  
min           -4.449283e+06   -92.053810  
25%           -1.588250e+04    -0.947478  
50%            8.100000e+01     0.125583  
75%            2.265875e+04     1.235286  
max            4.748899e+06     6.186389  
state                          0
year                           0
Value of crop production       0
Crop cash receipts             0
Cotton                      1994
Feed crops                     4
Food grains                  406
Fruits and nuts               65
Oil crops                    779
Vegetables and melons         62
All other crops                0
Home consumption               0
Inventory adjustment           0
yearly_avg                     0
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="temporal-trends" class="level4">
<h4 class="anchored" data-anchor-id="temporal-trends">Temporal Trends</h4>
<p>Precipitation over time Plots the national mean yearly PDSI across all states.</p>
<div id="5bb53689" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> precip_trend_figure(df):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    mean_precip_by_year <span class="op">=</span> df.groupby(<span class="st">"year"</span>)[<span class="st">"yearly_avg"</span>].mean()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    plt.plot(mean_precip_by_year)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Year"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Mean Normalized Precipitation"</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Average Precipitation Across the U.S. Over Time"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">"precip_over_time.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>precip_trend_figure(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="crop-income-over-time" class="level4">
<h4 class="anchored" data-anchor-id="crop-income-over-time">Crop income over time</h4>
<p>Plots the national mean crop cash receipts by year.</p>
<div id="a56f821e" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> crop_income_fig(df):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    mean_income_by_year <span class="op">=</span> df.groupby(<span class="st">"year"</span>)[<span class="st">"Crop cash receipts"</span>].mean()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    plt.plot(mean_income_by_year)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Year"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Mean Crop Cash Receipts"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Crop Income Trends Over Time"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">"crop_income_over_time.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>crop_income_fig(df) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="precipitationincome-relationships" class="level4">
<h4 class="anchored" data-anchor-id="precipitationincome-relationships">Precipitation–Income Relationships</h4>
<p>All state-year observations Scatter plot of normalized precipitation versus crop cash receipts.</p>
<div id="459a84ca" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> precip_v_income(df):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    plt.scatter(df[<span class="st">"yearly_avg"</span>], df[<span class="st">"Crop cash receipts"</span>], s<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Normalized Precipitation"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Crop Cash Receipts"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Precipitation vs. Crop Income"</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">"precip_vs_income_scatter.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>precip_v_income(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="state-level-averages" class="level4">
<h4 class="anchored" data-anchor-id="state-level-averages">State-level averages</h4>
<p>Each point represents a state averaged across all years.</p>
<div id="d6960d9e" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> statcompscatt(df):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    state_summary <span class="op">=</span> df.groupby(<span class="st">"state"</span>)[[<span class="st">"yearly_avg"</span>, <span class="st">"Crop cash receipts"</span>]].mean()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    plt.scatter(state_summary[<span class="st">"yearly_avg"</span>], state_summary[<span class="st">"Crop cash receipts"</span>])</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Mean Normalized Precipitation"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Mean Crop Cash Receipts"</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"State-Level Income vs. Precipitation"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">"state_level_precip_vs_income.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>statcompscatt(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="correlation-analysis" class="level4">
<h4 class="anchored" data-anchor-id="correlation-analysis">Correlation Analysis</h4>
<p>correl(df) Computes the Pearson correlation between precipitation and crop income.</p>
<div id="7b375339" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> correl(df):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    corr <span class="op">=</span> df[[<span class="st">"yearly_avg"</span>, <span class="st">"Crop cash receipts"</span>]].corr()</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Correlation Matrix:</span><span class="ch">\n</span><span class="st">"</span>, corr)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> corr</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> correl(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Correlation Matrix:
                     yearly_avg  Crop cash receipts
yearly_avg            1.000000           -0.121813
Crop cash receipts   -0.121813            1.000000</code></pre>
</div>
</div>
<p>Correlation heatmap Visual summary of the precipitation–income relationship.</p>
<div id="72ff0ae8" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> heatmap(corr):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    plt.imshow(corr, cmap<span class="op">=</span><span class="st">"coolwarm"</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    plt.colorbar(label<span class="op">=</span><span class="st">"Correlation"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    plt.xticks([<span class="dv">0</span>,<span class="dv">1</span>], [<span class="st">"Precip"</span>, <span class="st">"Income"</span>])</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    plt.yticks([<span class="dv">0</span>,<span class="dv">1</span>], [<span class="st">"Precip"</span>, <span class="st">"Income"</span>])</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Correlation Heatmap"</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">"correlation_heatmap.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>heatmap(corr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="outputs" class="level4">
<h4 class="anchored" data-anchor-id="outputs">Outputs</h4>
<p>Running the EDA section produces the following figures:</p>
<p>precip_over_time.png</p>
<p>crop_income_over_time.png</p>
<p>precip_vs_income_scatter.png</p>
<p>state_level_precip_vs_income.png</p>
<p>correlation_heatmap.png</p>
</section>
</section>
<section id="analysis" class="level3">
<h3 class="anchored" data-anchor-id="analysis">Analysis</h3>
<p>These functions will help us to center our data, remove data that contains errors. They will also help us plot variables on scatter plots and calculate correlation coefficients between the variables.</p>
<ul>
<li><em>remove_outliers(df, col_name, threshold, lower = True)</em></li>
</ul>
<p>Overview: This function will return a new dataframe with rows removed based on the parameters given.</p>
<p>Args:</p>
<p><em>df</em>:Pandas DataFrame. This must contain columns with the names passed in as other arguments. <em>col_name</em>:str. Name of column contianing the incorrect data. (“col3”) <em>threshold</em>:numeric. This is a numeric value to filter out values exceeding the threshold. We opted for this instead of equal to a threshold as simple functions already exist for that. (-50) <em>lower</em>:Bool. Indicates if filtering out all values less than, or greater than the threshold value. (True)</p>
<p>Impact: Returns a pandas DataFrame. Does not write to any files.</p>
<p>Example:</p>
<p>Original df</p>
<div id="c72459c2" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> remove_outliers</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col1"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>],</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col2"</span>: [<span class="dv">1</span>, <span class="op">-</span><span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   col1  col2
0     1     1
1     2    -3
2     3     1
3     4     1</code></pre>
</div>
</div>
<p>Using the function</p>
<div id="5333df09" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> remove_outliers</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> remove_outliers(df, <span class="st">"col2"</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   col1  col2
0     1     1
2     3     1
3     4     1</code></pre>
</div>
</div>
<ul>
<li><em>center_column(df, col_name, col_group, col_stand_name)</em></li>
</ul>
<p>Overview: This function will add another column to a dataframe that centers the data by group. In other words, it will take the mean of groups within the dataset. Then, it will take the values of that column, and for each row subtract the group mean that that row pertains to.</p>
<p>Args: <em>df</em>:Pandas DataFrame. This must contain columns with the names passed in as other arguments. <em>col_name</em>:str. Name of column that will have values centered “col4” <em>col_group</em>:list. Contains strings where each string is a column to be grouped on ([“col1”, “col2”, “col3”]) <em>col_stand_name</em>:str. Name for new column contains centered values. (“colCentered”)</p>
<p>Impact:</p>
<p>Returns df with an addition column for the centered data. Does not write any files.</p>
<p>Example:</p>
<p>Original df</p>
<div id="9dddfb24" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> center_column</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col1"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>],</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col2"</span>: [<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>]</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   col1 col2
0     1    A
1     2    A
2     3    A
3     4    A
4     5    A
5     6    A</code></pre>
</div>
</div>
<p>Using the function</p>
<div id="8e37ebba" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> center_column</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>col_name <span class="op">=</span> <span class="st">"col1"</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>col_group <span class="op">=</span> [<span class="st">"col2"</span>]</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>col_stand_name <span class="op">=</span> <span class="st">"col1_centered"</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> center_column(df, col_name, col_group, col_stand_name)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   col1 col2  col1_centered
0     1    A           -2.5
1     2    A           -1.5
2     3    A           -0.5
3     4    A            0.5
4     5    A            1.5
5     6    A            2.5</code></pre>
</div>
</div>
<ul>
<li><em>corr_and_plot(df, col1, col2, plot_file, n_digits)</em></li>
</ul>
<p>Overview: Creates a plot using <em>matplotlib</em> library, saves it to a file and includes correlation between variables in plot.</p>
<p>Args: <em>df</em>:Pandas DataFrame. This must contain columns with the names passed in as other arguments. <em>col1</em>:str. Name of column to plot on x-axis. (“col3”) <em>col2</em>:str. Name of column to plot on y-axis. (“col2”) <em>plot_file</em>:str. File name for .png of plot. (“plot.png”) <em>n_digits</em>:int. Integer for rounding correlation coefficent value (4)</p>
<p>Impact: Returns the plot from a matplotlib.pyplot. Also saves the plot as a file.</p>
<p>Example:</p>
<div id="b63830a0" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> corr_and_plot, remove_outliers</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#prepping data for plot example</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'combined_farm_precip.csv'</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>col_name <span class="op">=</span> <span class="st">"yearly_avg"</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="op">-</span><span class="dv">50</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> remove_outliers(df, col_name, threshold, lower <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>colx <span class="op">=</span> <span class="st">"yearly_avg"</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>coly <span class="op">=</span> <span class="st">"Value of crop production"</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>plot_file <span class="op">=</span> <span class="ss">f"plot_</span><span class="sc">{</span>colx<span class="sc">}</span><span class="ss">_vs_</span><span class="sc">{</span>coly<span class="sc">}</span><span class="ss">.png"</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>n_digits <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> corr_and_plot(df, colx, coly, plot_file,n_digits)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="documentation_files/figure-html/cell-20-output-1.png" width="663" height="537" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<ul>
<li><em>make_scatter_w_cat(df, colx, coly, colcat, plot_file)</em></li>
</ul>
<p>Overview: Uses seaborn package to produce a scatterplot that colors the data by a categorical variable in the df.</p>
<p>Args: <em>df</em>:Pandas DataFrame. This must contain columns with the names passed in as other arguments. <em>colx</em>:str. Name of column to plot on x-axis. (“col3”) <em>coly</em>:str. Name of column to plot on y-axis. (“col2”) <em>colcat</em>:str. Name of column containing categorical variable to group by. <em>plot_file</em>:str. File name for .png of plot. (“plot.png”)</p>
<p>Impact: Returns plot from matplotlib.pyplot. Also saves plot as a .png file.</p>
<p>Example:</p>
<div id="553c7555" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> make_scatter_w_cat</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col1"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>],</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col2"</span>: [<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"B"</span>,<span class="st">"B"</span>],</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col3"</span>: [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> make_scatter_w_cat(df, <span class="st">"col1"</span>, <span class="st">"col3"</span>, <span class="st">"col2"</span>, <span class="st">"example.png"</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>plt.show</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="documentation_files/figure-html/cell-21-output-1.png" width="713" height="429" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 672x480 with 0 Axes&gt;</code></pre>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Documentation For Package"</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sources</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Precipitation</span><span class="co">](https://www.ncei.noaa.gov/pub/data/cirs/drd/drd964x.pdsi.txt)</span> - NOAA (National Oceanic and Atmospheric Administration). This data uses the PDSI metric. Which is an indicator of how much water is available compared to the average amount of water normally available in that region. It factors in precipitation, temperature, and soil moisture. This data tells us the monthly PDSI of each region of each state for each year. It is reasonable to average across regions, because for each state the regions are roughy equal in size.</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Farm Income</span><span class="co">](https://data.ers.usda.gov/reports.aspx?ID=4047#Pae6cc0e926f6455896ee3f109f3b7f51_14_109iT0R0x43)</span> - USDA (United States Department of Agriculture). This website contains an excel spreadsheet that can be downloaded. This excel file contians a sheet for each state. Each state's sheet contains a column per year where each row contains dollar values for different parts of a State's agricultural profits. It includes crop, livestock, and expense data among other things.</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="fu">### File Descriptions</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>The Precipitation dataset is a .txt file. It's first column contains a code for the state, division, element (in this case PDSI), and year. It then contains a column for each month, which contains the PDSI value for that month.</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>An example row from the txt file:</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{python}</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="co">import pandas as pd</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co">print(pd.read_fwf("rain.txt").head(1).to_markdown())</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co">``` --&gt;</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> 0101051895 <span class="pp">|</span>   0.11 <span class="pp">|</span>   -0.81 <span class="pp">|</span>   -0.56 <span class="pp">|</span>   -0.72 <span class="pp">|</span>   -0.85 <span class="pp">|</span>   -0.99 <span class="pp">|</span>   -0.90 <span class="pp">|</span>   -1.13 <span class="pp">|</span>   -1.69 <span class="pp">|</span>   -1.72 <span class="pp">|</span>   -2.04 <span class="pp">|</span>   -2.12 <span class="pp">|</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>State code = 01 (which corresponds to a state)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>Division number = 01 (first climate division in Florida)</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>Element code = 05 (PDSI)</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>Year = 1895</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>January PDSI value = 0.11</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>February PDSI value = -0.81</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>March PDSI value = -0.56</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>… and so forth through December.</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>The Farm Income dataset is an .xlsx file made up of several sheets, one for each state as well as informational guides. It contains rows of data separated by year in columns, containing income data across several different industry types. We chose to focus on food-type crops, found in the first block-like row section of each state sheet.</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>An example row from the text file:</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a><span class="co"># import pandas as pd</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a><span class="co"># # read the "Alabama" sheet and show the first few rows</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a><span class="co"># df = pd.read_excel("VA_State_US (1).xlsx", sheet_name="Alabama")</span></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df[5,].to_markdown())</span></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a><span class="fu">### Combined Data File</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>The combined dataset contains information from both datasets joined on the state and the year. It provides PDSI averages for the state along with the state's to total income, and income by crop category. An example row of the data is included below.</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.read_csv(<span class="st">"combined_farm_precip.csv"</span>).head(<span class="dv">1</span>).to_markdown())</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a><span class="fu"># Functions</span></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a><span class="fu">### Precipitation/PDSI Data Preparation</span></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>These functions will use a url file to produce write multiple files. The raw output from the url to a txt and csv file. It then produces a table that provides the average PDSI per state per year and writes it to a csv.</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**read_url_txt(url, txt_name, csv_name, colspecs, cols)**</span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>Overview:</span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>Input is a url containing a .txt file.</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>Uses requests package to have requests.get output.</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a>Saves a .csv file and uses txt_to_csv() (see below) to save .txt file of dataset.</span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a>Calls *txt_to_csv* as part of process.</span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a>Args:</span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a>*url*:str - a url pointing to a remote .txt file. ("https://www.ncei.noaa.gov/pub/data/cirs/drd/drd964x.pdsi.txt")</span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>*txt_name*:str - the name the .txt file will be saved to. ("name.txt")</span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a>*csv_name*:str - the name the .csv file will be saved to. ("name.csv")</span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a>*col_specs*:list - contains tuples that indicate how to break string into parts. Must be same length as *cols*.(<span class="co">[</span><span class="ot">(0, 2), (2, 4), (4, 6), (6, 10),(10, 17)</span><span class="co">]</span>)</span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a>*cols*:list - contains names of new columns that are created with col_specs. Must be same length as *col_specs*. (cols = <span class="co">[</span><span class="ot">"col1", "col2", "col3", "col4","col5"</span><span class="co">]</span>)</span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a>Impact:</span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a>Returns None. This function will write files, but will not return anything.</span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**txt_to_csv(txt_name, csv_name, colspecs, cols)**</span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>Overview:</span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a>Reads txt file.</span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a>Parses government coding system from first column into various columns.</span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>Converts strings cells containing PDSI information to numeric values, </span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a>Writes new broken up table to csv.</span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>Args:</span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a>*txt_name*:str - the name the .txt file will be saved to. ("name.txt")</span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a>*csv_name*:str - the name the .csv file will be saved to. ("name.csv")</span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a>*col_specs*:list - contains tuples that indicate how to break string into parts. Must be same length as *cols*.(<span class="co">[</span><span class="ot">(0, 2), (2, 4), (4, 6), (6, 10),(10, 17)</span><span class="co">]</span>)</span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a>*cols*:list - contains names of new columns that are created with col_specs. Must be same length as *col_specs*. (cols = <span class="co">[</span><span class="ot">"col1", "col2", "col3", "col4","col5"</span><span class="co">]</span>)</span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a>Impact:</span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>Returns None. This function will write files, but will not return anything.</span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a>Example:</span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> read_url_txt, txt_to_csv</span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://www.ncei.noaa.gov/pub/data/cirs/drd/drd964x.pdsi.txt"</span></span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a>txt_name <span class="op">=</span> <span class="st">"rain.txt"</span></span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a>csv_name <span class="op">=</span> <span class="st">"rain_dirty.csv"</span></span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a>colspecs <span class="op">=</span> [</span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>, <span class="dv">2</span>), (<span class="dv">2</span>, <span class="dv">4</span>), (<span class="dv">4</span>, <span class="dv">6</span>), (<span class="dv">6</span>, <span class="dv">10</span>),</span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">10</span>, <span class="dv">17</span>), (<span class="dv">17</span>, <span class="dv">24</span>), (<span class="dv">24</span>, <span class="dv">31</span>), (<span class="dv">31</span>, <span class="dv">38</span>),</span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">38</span>, <span class="dv">45</span>), (<span class="dv">45</span>, <span class="dv">52</span>), (<span class="dv">52</span>, <span class="dv">59</span>), (<span class="dv">59</span>, <span class="dv">66</span>),</span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">66</span>, <span class="dv">73</span>), (<span class="dv">73</span>, <span class="dv">80</span>), (<span class="dv">80</span>, <span class="dv">87</span>), (<span class="dv">87</span>, <span class="dv">94</span>)</span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [</span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state"</span>, <span class="st">"division"</span>, <span class="st">"element"</span>, <span class="st">"year"</span>,</span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a>    <span class="st">"jan"</span>,<span class="st">"feb"</span>,<span class="st">"mar"</span>,<span class="st">"apr"</span>,<span class="st">"may"</span>,<span class="st">"jun"</span>,<span class="st">"jul"</span>,<span class="st">"aug"</span>,</span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sep"</span>,<span class="st">"oct"</span>,<span class="st">"nov"</span>,<span class="st">"dec"</span></span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a>read_url_txt(url, txt_name, csv_name, colspecs, cols)</span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.read_csv(csv_name).head(<span class="dv">1</span>).to_markdown())</span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**normalized_data(df, months, groups, csv_name_clean, new_col_name)**</span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a>Overview:</span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a>Averages the PDSI across months for each row, and saves it as a new column. This is the yearly average PDSI for each district of each state.</span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a>Creates a new table averaging the yearly PDSI for every state across all its districts.</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a>Writes the table to a csv.</span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a>Args:</span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a>*df_to_read*:str - contains name of csv to read.</span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a>*new_col_name*:str - name of new column that is added when calculating average for each row.</span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a>*csv_name_clean*:str - name of csv you want to save your calculated table to. ("averaged_vals.csv")</span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a>*months*:list - contains strings of values that will be used to calculate the averages for each row. (<span class="co">[</span><span class="ot">"col1","col2","col3"</span><span class="co">]</span>)</span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a>*groups*:list - contains strings of values to group by when calculating averages across rows. (<span class="co">[</span><span class="ot">"group1", "group2"</span><span class="co">]</span>)</span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a>Impact:</span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a>Returns None. This function will write files, but will not return anything.</span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a>Example:</span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> normalized_data</span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a>months <span class="op">=</span> [<span class="st">"jan"</span>,<span class="st">"feb"</span>,<span class="st">"mar"</span>,<span class="st">'apr'</span>,<span class="st">"may"</span>,<span class="st">"jun"</span>,<span class="st">"jul"</span>,<span class="st">"aug"</span>,<span class="st">"sep"</span>,<span class="st">"oct"</span>,<span class="st">"nov"</span>,<span class="st">"dec"</span>]</span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a>groups <span class="op">=</span> [<span class="st">"state"</span>,<span class="st">"year"</span>]</span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a>new_col_name <span class="op">=</span> <span class="st">"yearly_avg"</span></span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a>csv_name_clean <span class="op">=</span> <span class="st">"rain_clean.csv"</span></span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a>df_to_read <span class="op">=</span> <span class="st">"rain_dirty.csv"</span></span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a>normalized_data(df_to_read, new_col_name, csv_name_clean, months, groups)</span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.read_csv(csv_name_clean).head(<span class="dv">1</span>).to_markdown())</span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a><span class="fu">### Farm Data Preparation</span></span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a>These functions extract and standardize farm income and crop-category data from historical USDA Excel workbooks. The workflow converts wide, state-specific tables into a tidy format with one row per state per year, matching the structure of <span class="in">`FarmIncome.xlsx`</span>. The cleaned output is written to a CSV file for direct merging with the PDSI dataset.</span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Utility Functions</span></span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**row_by_label(df, label)**</span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a>**Overview:**  </span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a>Finds the first row in a DataFrame whose first column exactly matches a specified text label. This is used to locate crop-category rows (e.g., *Cotton*, *Food grains*) in the VA workbook sheets.</span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a>**Args:**  </span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*df*: pd.DataFrame — DataFrame read from an Excel sheet  </span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*label*: str — row label to search for in the first column  </span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a>**Impact:**  </span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a>Returns a pandas Series for the matched row, or <span class="in">`None`</span> if the label is not found. This function does not write files.</span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Farm Data Extraction</span></span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**extract_state_rows(va_path, sheet_name, state_id, years_needed)**</span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a>**Overview:**  </span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a>Extracts crop-related income values for a single state from the VA workbook and returns a standardized table with one row per year. The function maps Excel year headers to columns, pulls relevant crop-category rows, and formats the results to match the structure of <span class="in">`FarmIncome.xlsx`</span>.</span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a>**Args:**  </span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*va_path*: str — path to the VA workbook  </span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*sheet_name*: str — name of the Excel sheet corresponding to the state  </span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*state_id*: int — numeric identifier for the state (1–48)  </span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*years_needed*: list<span class="co">[</span><span class="ot">int</span><span class="co">]</span> — years to extract  </span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a>**Impact:**  </span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a>Returns a pd.DataFrame containing:</span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`state`</span>, <span class="in">`year`</span></span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Value of crop production`</span></span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Crop cash receipts`</span></span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Cotton`</span></span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Feed crops`</span></span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Food grains`</span></span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Fruits and nuts`</span></span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Oil crops`</span></span>
<span id="cb35-218"><a href="#cb35-218" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Vegetables and melons`</span></span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`All other crops`</span></span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Home consumption`</span></span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Inventory adjustment`</span></span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a>No files are written by this function.</span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-227"><a href="#cb35-227" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Full Farm Dataset Construction</span></span>
<span id="cb35-228"><a href="#cb35-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**scrape_farm_data()**</span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a>**Overview:**  </span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a>Builds a complete farm income dataset for all 48 contiguous U.S. states by looping through each state sheet in the VA workbook, extracting standardized crop data, and combining the results into a single tidy table.</span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a>Key steps:</span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Reads <span class="in">`FarmIncome.xlsx`</span> to obtain the target years and column order  </span>
<span id="cb35-236"><a href="#cb35-236" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Assigns numeric state IDs (1–48) in alphabetical order  </span>
<span id="cb35-237"><a href="#cb35-237" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Extracts yearly crop data for each state using <span class="in">`extract_state_rows`</span>  </span>
<span id="cb35-238"><a href="#cb35-238" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Concatenates, sorts, and aligns all state data  </span>
<span id="cb35-239"><a href="#cb35-239" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Writes the final dataset to a CSV file  </span>
<span id="cb35-240"><a href="#cb35-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-241"><a href="#cb35-241" aria-hidden="true" tabindex="-1"></a>**Args:**  </span>
<span id="cb35-242"><a href="#cb35-242" aria-hidden="true" tabindex="-1"></a>None</span>
<span id="cb35-243"><a href="#cb35-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-244"><a href="#cb35-244" aria-hidden="true" tabindex="-1"></a>**Impact:**  </span>
<span id="cb35-245"><a href="#cb35-245" aria-hidden="true" tabindex="-1"></a>Returns None. Writes the cleaned dataset to:</span>
<span id="cb35-246"><a href="#cb35-246" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`FarmIncome_full.csv`**</span>
<span id="cb35-247"><a href="#cb35-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-248"><a href="#cb35-248" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb35-249"><a href="#cb35-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-250"><a href="#cb35-250" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Example</span></span>
<span id="cb35-251"><a href="#cb35-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-254"><a href="#cb35-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-255"><a href="#cb35-255" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> scrape_farm_data</span>
<span id="cb35-256"><a href="#cb35-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-257"><a href="#cb35-257" aria-hidden="true" tabindex="-1"></a>scrape_farm_data()</span>
<span id="cb35-258"><a href="#cb35-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-259"><a href="#cb35-259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-260"><a href="#cb35-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-261"><a href="#cb35-261" aria-hidden="true" tabindex="-1"></a><span class="fu">### Combining data</span></span>
<span id="cb35-262"><a href="#cb35-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-263"><a href="#cb35-263" aria-hidden="true" tabindex="-1"></a>We created a function to merge two datasets on specific values and to save the merged data in a csv.</span>
<span id="cb35-264"><a href="#cb35-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-265"><a href="#cb35-265" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**merge_csvs(new_csv_name, csvs, group_on)**</span>
<span id="cb35-266"><a href="#cb35-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-267"><a href="#cb35-267" aria-hidden="true" tabindex="-1"></a>Overview:</span>
<span id="cb35-268"><a href="#cb35-268" aria-hidden="true" tabindex="-1"></a>Reads two .csv files.</span>
<span id="cb35-269"><a href="#cb35-269" aria-hidden="true" tabindex="-1"></a>Merges the files on a set of columns.</span>
<span id="cb35-270"><a href="#cb35-270" aria-hidden="true" tabindex="-1"></a>Writes the merged table to a .csv.</span>
<span id="cb35-271"><a href="#cb35-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-272"><a href="#cb35-272" aria-hidden="true" tabindex="-1"></a>Args:</span>
<span id="cb35-273"><a href="#cb35-273" aria-hidden="true" tabindex="-1"></a>*new_csv_name*:str Name to use for merged .csv file ("merged.csv")</span>
<span id="cb35-274"><a href="#cb35-274" aria-hidden="true" tabindex="-1"></a>*csvs*:list Contains two strings where each string is a .csv to be read and merged (<span class="co">[</span><span class="ot">"tble1.csv", "tble2.csv"</span><span class="co">]</span>)</span>
<span id="cb35-275"><a href="#cb35-275" aria-hidden="true" tabindex="-1"></a>*group_on*:list Contains strings where each string is a column to be grouped on (<span class="co">[</span><span class="ot">"col1", "col2", "col3"</span><span class="co">]</span>)</span>
<span id="cb35-276"><a href="#cb35-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-277"><a href="#cb35-277" aria-hidden="true" tabindex="-1"></a>Impact:</span>
<span id="cb35-278"><a href="#cb35-278" aria-hidden="true" tabindex="-1"></a>Returns None. Writes a new .csv file</span>
<span id="cb35-279"><a href="#cb35-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-280"><a href="#cb35-280" aria-hidden="true" tabindex="-1"></a>Example:</span>
<span id="cb35-281"><a href="#cb35-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-282"><a href="#cb35-282" aria-hidden="true" tabindex="-1"></a>Starting csvs:</span>
<span id="cb35-285"><a href="#cb35-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-286"><a href="#cb35-286" aria-hidden="true" tabindex="-1"></a>csvs <span class="op">=</span> [<span class="st">"FarmIncome_full.csv"</span>, <span class="st">"rain_clean.csv"</span>]</span>
<span id="cb35-287"><a href="#cb35-287" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.read_csv(csvs[<span class="dv">0</span>]).head(<span class="dv">1</span>).to_markdown())</span>
<span id="cb35-288"><a href="#cb35-288" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.read_csv(csvs[<span class="dv">1</span>]).head(<span class="dv">1</span>).to_markdown())</span>
<span id="cb35-289"><a href="#cb35-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-290"><a href="#cb35-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-291"><a href="#cb35-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-292"><a href="#cb35-292" aria-hidden="true" tabindex="-1"></a>Merging them:</span>
<span id="cb35-295"><a href="#cb35-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-296"><a href="#cb35-296" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-297"><a href="#cb35-297" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> merge_csvs</span>
<span id="cb35-298"><a href="#cb35-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-299"><a href="#cb35-299" aria-hidden="true" tabindex="-1"></a>csvs <span class="op">=</span> [<span class="st">"FarmIncome_full.csv"</span>, <span class="st">"rain_clean.csv"</span>]</span>
<span id="cb35-300"><a href="#cb35-300" aria-hidden="true" tabindex="-1"></a>group_on <span class="op">=</span> [<span class="st">"state"</span>, <span class="st">"year"</span>]</span>
<span id="cb35-301"><a href="#cb35-301" aria-hidden="true" tabindex="-1"></a>new_csv_name <span class="op">=</span> <span class="st">"combined_farm_precip.csv"</span></span>
<span id="cb35-302"><a href="#cb35-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-303"><a href="#cb35-303" aria-hidden="true" tabindex="-1"></a>merge_csvs(new_csv_name, csvs, group_on)</span>
<span id="cb35-304"><a href="#cb35-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-305"><a href="#cb35-305" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.read_csv(new_csv_name).head(<span class="dv">1</span>).to_markdown())</span>
<span id="cb35-306"><a href="#cb35-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-307"><a href="#cb35-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-308"><a href="#cb35-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-309"><a href="#cb35-309" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exploratory Data Analysis (EDA)</span></span>
<span id="cb35-310"><a href="#cb35-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-311"><a href="#cb35-311" aria-hidden="true" tabindex="-1"></a>This section performs exploratory analysis on the merged precipitation–farm income dataset to validate data quality, summarize distributions, and visualize temporal and cross-sectional relationships between normalized precipitation (PDSI) and crop income. All figures are saved as high-resolution PNG files.</span>
<span id="cb35-312"><a href="#cb35-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-313"><a href="#cb35-313" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Data Loading</span></span>
<span id="cb35-314"><a href="#cb35-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-315"><a href="#cb35-315" aria-hidden="true" tabindex="-1"></a>The combined dataset produced by merge_csvs() is read once and reused across all EDA functions.</span>
<span id="cb35-318"><a href="#cb35-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-319"><a href="#cb35-319" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-320"><a href="#cb35-320" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb35-321"><a href="#cb35-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-322"><a href="#cb35-322" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"combined_farm_precip.csv"</span>)</span>
<span id="cb35-323"><a href="#cb35-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-324"><a href="#cb35-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-325"><a href="#cb35-325" aria-hidden="true" tabindex="-1"></a>This dataset contains one row per state per year, including normalized precipitation (yearly_avg) and multiple farm income variables.</span>
<span id="cb35-326"><a href="#cb35-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-327"><a href="#cb35-327" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Summary Checks</span></span>
<span id="cb35-328"><a href="#cb35-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-329"><a href="#cb35-329" aria-hidden="true" tabindex="-1"></a>basic_summary(df)</span>
<span id="cb35-330"><a href="#cb35-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-331"><a href="#cb35-331" aria-hidden="true" tabindex="-1"></a>Provides a quick integrity check of the dataset by displaying sample rows, descriptive statistics, and missing-value counts.</span>
<span id="cb35-332"><a href="#cb35-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-335"><a href="#cb35-335" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-336"><a href="#cb35-336" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> basic_summary(df):</span>
<span id="cb35-337"><a href="#cb35-337" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df.head())</span>
<span id="cb35-338"><a href="#cb35-338" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df.describe())</span>
<span id="cb35-339"><a href="#cb35-339" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df.isna().<span class="bu">sum</span>())</span>
<span id="cb35-340"><a href="#cb35-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-341"><a href="#cb35-341" aria-hidden="true" tabindex="-1"></a>basic_summary(df)</span>
<span id="cb35-342"><a href="#cb35-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-343"><a href="#cb35-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-344"><a href="#cb35-344" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Temporal Trends</span></span>
<span id="cb35-345"><a href="#cb35-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-346"><a href="#cb35-346" aria-hidden="true" tabindex="-1"></a>Precipitation over time</span>
<span id="cb35-347"><a href="#cb35-347" aria-hidden="true" tabindex="-1"></a>Plots the national mean yearly PDSI across all states.</span>
<span id="cb35-348"><a href="#cb35-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-351"><a href="#cb35-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-352"><a href="#cb35-352" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> precip_trend_figure(df):</span>
<span id="cb35-353"><a href="#cb35-353" aria-hidden="true" tabindex="-1"></a>    mean_precip_by_year <span class="op">=</span> df.groupby(<span class="st">"year"</span>)[<span class="st">"yearly_avg"</span>].mean()</span>
<span id="cb35-354"><a href="#cb35-354" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb35-355"><a href="#cb35-355" aria-hidden="true" tabindex="-1"></a>    plt.plot(mean_precip_by_year)</span>
<span id="cb35-356"><a href="#cb35-356" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Year"</span>)</span>
<span id="cb35-357"><a href="#cb35-357" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Mean Normalized Precipitation"</span>)</span>
<span id="cb35-358"><a href="#cb35-358" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Average Precipitation Across the U.S. Over Time"</span>)</span>
<span id="cb35-359"><a href="#cb35-359" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb35-360"><a href="#cb35-360" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">"precip_over_time.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb35-361"><a href="#cb35-361" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb35-362"><a href="#cb35-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-363"><a href="#cb35-363" aria-hidden="true" tabindex="-1"></a>precip_trend_figure(df)</span>
<span id="cb35-364"><a href="#cb35-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-365"><a href="#cb35-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-366"><a href="#cb35-366" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Crop income over time</span></span>
<span id="cb35-367"><a href="#cb35-367" aria-hidden="true" tabindex="-1"></a>Plots the national mean crop cash receipts by year.</span>
<span id="cb35-368"><a href="#cb35-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-371"><a href="#cb35-371" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-372"><a href="#cb35-372" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> crop_income_fig(df):</span>
<span id="cb35-373"><a href="#cb35-373" aria-hidden="true" tabindex="-1"></a>    mean_income_by_year <span class="op">=</span> df.groupby(<span class="st">"year"</span>)[<span class="st">"Crop cash receipts"</span>].mean()</span>
<span id="cb35-374"><a href="#cb35-374" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb35-375"><a href="#cb35-375" aria-hidden="true" tabindex="-1"></a>    plt.plot(mean_income_by_year)</span>
<span id="cb35-376"><a href="#cb35-376" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Year"</span>)</span>
<span id="cb35-377"><a href="#cb35-377" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Mean Crop Cash Receipts"</span>)</span>
<span id="cb35-378"><a href="#cb35-378" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Crop Income Trends Over Time"</span>)</span>
<span id="cb35-379"><a href="#cb35-379" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb35-380"><a href="#cb35-380" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">"crop_income_over_time.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb35-381"><a href="#cb35-381" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb35-382"><a href="#cb35-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-383"><a href="#cb35-383" aria-hidden="true" tabindex="-1"></a>crop_income_fig(df) </span>
<span id="cb35-384"><a href="#cb35-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-385"><a href="#cb35-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-386"><a href="#cb35-386" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Precipitation–Income Relationships</span></span>
<span id="cb35-387"><a href="#cb35-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-388"><a href="#cb35-388" aria-hidden="true" tabindex="-1"></a>All state-year observations</span>
<span id="cb35-389"><a href="#cb35-389" aria-hidden="true" tabindex="-1"></a>Scatter plot of normalized precipitation versus crop cash receipts.</span>
<span id="cb35-390"><a href="#cb35-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-393"><a href="#cb35-393" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-394"><a href="#cb35-394" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> precip_v_income(df):</span>
<span id="cb35-395"><a href="#cb35-395" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb35-396"><a href="#cb35-396" aria-hidden="true" tabindex="-1"></a>    plt.scatter(df[<span class="st">"yearly_avg"</span>], df[<span class="st">"Crop cash receipts"</span>], s<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb35-397"><a href="#cb35-397" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Normalized Precipitation"</span>)</span>
<span id="cb35-398"><a href="#cb35-398" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Crop Cash Receipts"</span>)</span>
<span id="cb35-399"><a href="#cb35-399" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Precipitation vs. Crop Income"</span>)</span>
<span id="cb35-400"><a href="#cb35-400" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb35-401"><a href="#cb35-401" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">"precip_vs_income_scatter.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb35-402"><a href="#cb35-402" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb35-403"><a href="#cb35-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-404"><a href="#cb35-404" aria-hidden="true" tabindex="-1"></a>precip_v_income(df)</span>
<span id="cb35-405"><a href="#cb35-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-406"><a href="#cb35-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-407"><a href="#cb35-407" aria-hidden="true" tabindex="-1"></a><span class="fu">#### State-level averages</span></span>
<span id="cb35-408"><a href="#cb35-408" aria-hidden="true" tabindex="-1"></a>Each point represents a state averaged across all years.</span>
<span id="cb35-409"><a href="#cb35-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-410"><a href="#cb35-410" aria-hidden="true" tabindex="-1"></a><span class="in">``` {python}</span></span>
<span id="cb35-411"><a href="#cb35-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-412"><a href="#cb35-412" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> statcompscatt(df):</span>
<span id="cb35-413"><a href="#cb35-413" aria-hidden="true" tabindex="-1"></a>    state_summary <span class="op">=</span> df.groupby(<span class="st">"state"</span>)[[<span class="st">"yearly_avg"</span>, <span class="st">"Crop cash receipts"</span>]].mean()</span>
<span id="cb35-414"><a href="#cb35-414" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb35-415"><a href="#cb35-415" aria-hidden="true" tabindex="-1"></a>    plt.scatter(state_summary[<span class="st">"yearly_avg"</span>], state_summary[<span class="st">"Crop cash receipts"</span>])</span>
<span id="cb35-416"><a href="#cb35-416" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Mean Normalized Precipitation"</span>)</span>
<span id="cb35-417"><a href="#cb35-417" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Mean Crop Cash Receipts"</span>)</span>
<span id="cb35-418"><a href="#cb35-418" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"State-Level Income vs. Precipitation"</span>)</span>
<span id="cb35-419"><a href="#cb35-419" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb35-420"><a href="#cb35-420" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">"state_level_precip_vs_income.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb35-421"><a href="#cb35-421" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb35-422"><a href="#cb35-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-423"><a href="#cb35-423" aria-hidden="true" tabindex="-1"></a>statcompscatt(df)</span>
<span id="cb35-424"><a href="#cb35-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-425"><a href="#cb35-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-426"><a href="#cb35-426" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Correlation Analysis</span></span>
<span id="cb35-427"><a href="#cb35-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-428"><a href="#cb35-428" aria-hidden="true" tabindex="-1"></a>correl(df)</span>
<span id="cb35-429"><a href="#cb35-429" aria-hidden="true" tabindex="-1"></a>Computes the Pearson correlation between precipitation and crop income.</span>
<span id="cb35-430"><a href="#cb35-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-433"><a href="#cb35-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-434"><a href="#cb35-434" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> correl(df):</span>
<span id="cb35-435"><a href="#cb35-435" aria-hidden="true" tabindex="-1"></a>    corr <span class="op">=</span> df[[<span class="st">"yearly_avg"</span>, <span class="st">"Crop cash receipts"</span>]].corr()</span>
<span id="cb35-436"><a href="#cb35-436" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Correlation Matrix:</span><span class="ch">\n</span><span class="st">"</span>, corr)</span>
<span id="cb35-437"><a href="#cb35-437" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> corr</span>
<span id="cb35-438"><a href="#cb35-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-439"><a href="#cb35-439" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> correl(df)</span>
<span id="cb35-440"><a href="#cb35-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-441"><a href="#cb35-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-442"><a href="#cb35-442" aria-hidden="true" tabindex="-1"></a>Correlation heatmap</span>
<span id="cb35-443"><a href="#cb35-443" aria-hidden="true" tabindex="-1"></a>Visual summary of the precipitation–income relationship.</span>
<span id="cb35-444"><a href="#cb35-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-447"><a href="#cb35-447" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-448"><a href="#cb35-448" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> heatmap(corr):</span>
<span id="cb35-449"><a href="#cb35-449" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb35-450"><a href="#cb35-450" aria-hidden="true" tabindex="-1"></a>    plt.imshow(corr, cmap<span class="op">=</span><span class="st">"coolwarm"</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb35-451"><a href="#cb35-451" aria-hidden="true" tabindex="-1"></a>    plt.colorbar(label<span class="op">=</span><span class="st">"Correlation"</span>)</span>
<span id="cb35-452"><a href="#cb35-452" aria-hidden="true" tabindex="-1"></a>    plt.xticks([<span class="dv">0</span>,<span class="dv">1</span>], [<span class="st">"Precip"</span>, <span class="st">"Income"</span>])</span>
<span id="cb35-453"><a href="#cb35-453" aria-hidden="true" tabindex="-1"></a>    plt.yticks([<span class="dv">0</span>,<span class="dv">1</span>], [<span class="st">"Precip"</span>, <span class="st">"Income"</span>])</span>
<span id="cb35-454"><a href="#cb35-454" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Correlation Heatmap"</span>)</span>
<span id="cb35-455"><a href="#cb35-455" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb35-456"><a href="#cb35-456" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">"correlation_heatmap.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb35-457"><a href="#cb35-457" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb35-458"><a href="#cb35-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-459"><a href="#cb35-459" aria-hidden="true" tabindex="-1"></a>heatmap(corr)</span>
<span id="cb35-460"><a href="#cb35-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-461"><a href="#cb35-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-462"><a href="#cb35-462" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Outputs</span></span>
<span id="cb35-463"><a href="#cb35-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-464"><a href="#cb35-464" aria-hidden="true" tabindex="-1"></a>Running the EDA section produces the following figures:</span>
<span id="cb35-465"><a href="#cb35-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-466"><a href="#cb35-466" aria-hidden="true" tabindex="-1"></a>precip_over_time.png</span>
<span id="cb35-467"><a href="#cb35-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-468"><a href="#cb35-468" aria-hidden="true" tabindex="-1"></a>crop_income_over_time.png</span>
<span id="cb35-469"><a href="#cb35-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-470"><a href="#cb35-470" aria-hidden="true" tabindex="-1"></a>precip_vs_income_scatter.png</span>
<span id="cb35-471"><a href="#cb35-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-472"><a href="#cb35-472" aria-hidden="true" tabindex="-1"></a>state_level_precip_vs_income.png</span>
<span id="cb35-473"><a href="#cb35-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-474"><a href="#cb35-474" aria-hidden="true" tabindex="-1"></a>correlation_heatmap.png</span>
<span id="cb35-475"><a href="#cb35-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-476"><a href="#cb35-476" aria-hidden="true" tabindex="-1"></a><span class="fu">### Analysis</span></span>
<span id="cb35-477"><a href="#cb35-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-478"><a href="#cb35-478" aria-hidden="true" tabindex="-1"></a>These functions will help us to center our data, remove data that contains errors. They will also help us plot variables on scatter plots and calculate correlation coefficients between the variables.</span>
<span id="cb35-479"><a href="#cb35-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-480"><a href="#cb35-480" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*remove_outliers(df, col_name, threshold, lower = True)*</span>
<span id="cb35-481"><a href="#cb35-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-482"><a href="#cb35-482" aria-hidden="true" tabindex="-1"></a>Overview:</span>
<span id="cb35-483"><a href="#cb35-483" aria-hidden="true" tabindex="-1"></a>This function will return a new dataframe with rows removed based on the parameters given. </span>
<span id="cb35-484"><a href="#cb35-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-485"><a href="#cb35-485" aria-hidden="true" tabindex="-1"></a>Args:</span>
<span id="cb35-486"><a href="#cb35-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-487"><a href="#cb35-487" aria-hidden="true" tabindex="-1"></a>*df*:Pandas DataFrame. This must contain columns with the names passed in as other arguments.</span>
<span id="cb35-488"><a href="#cb35-488" aria-hidden="true" tabindex="-1"></a>*col_name*:str. Name of column contianing the incorrect data. ("col3")</span>
<span id="cb35-489"><a href="#cb35-489" aria-hidden="true" tabindex="-1"></a>*threshold*:numeric. This is a numeric value to filter out values exceeding the threshold. We opted for this instead of equal to a threshold as simple functions already exist for that. (-50)</span>
<span id="cb35-490"><a href="#cb35-490" aria-hidden="true" tabindex="-1"></a>*lower*:Bool. Indicates if filtering out all values less than, or greater than the threshold value. (True)</span>
<span id="cb35-491"><a href="#cb35-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-492"><a href="#cb35-492" aria-hidden="true" tabindex="-1"></a>Impact:</span>
<span id="cb35-493"><a href="#cb35-493" aria-hidden="true" tabindex="-1"></a>Returns a pandas DataFrame. Does not write to any files.</span>
<span id="cb35-494"><a href="#cb35-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-495"><a href="#cb35-495" aria-hidden="true" tabindex="-1"></a>Example:</span>
<span id="cb35-496"><a href="#cb35-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-497"><a href="#cb35-497" aria-hidden="true" tabindex="-1"></a>Original df</span>
<span id="cb35-500"><a href="#cb35-500" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-501"><a href="#cb35-501" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-502"><a href="#cb35-502" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> remove_outliers</span>
<span id="cb35-503"><a href="#cb35-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-504"><a href="#cb35-504" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb35-505"><a href="#cb35-505" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col1"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>],</span>
<span id="cb35-506"><a href="#cb35-506" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col2"</span>: [<span class="dv">1</span>, <span class="op">-</span><span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb35-507"><a href="#cb35-507" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb35-508"><a href="#cb35-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-509"><a href="#cb35-509" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb35-510"><a href="#cb35-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-511"><a href="#cb35-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-512"><a href="#cb35-512" aria-hidden="true" tabindex="-1"></a>Using the function</span>
<span id="cb35-513"><a href="#cb35-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-516"><a href="#cb35-516" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-517"><a href="#cb35-517" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-518"><a href="#cb35-518" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> remove_outliers</span>
<span id="cb35-519"><a href="#cb35-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-520"><a href="#cb35-520" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> remove_outliers(df, <span class="st">"col2"</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb35-521"><a href="#cb35-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-522"><a href="#cb35-522" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb35-523"><a href="#cb35-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-524"><a href="#cb35-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-525"><a href="#cb35-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-526"><a href="#cb35-526" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*center_column(df, col_name, col_group, col_stand_name)*</span>
<span id="cb35-527"><a href="#cb35-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-528"><a href="#cb35-528" aria-hidden="true" tabindex="-1"></a>Overview:</span>
<span id="cb35-529"><a href="#cb35-529" aria-hidden="true" tabindex="-1"></a>This function will add another column to a dataframe that centers the data by group. In other words, it will take the mean of groups within the dataset. Then, it will take the values of that column, and for each row subtract the group mean that that row pertains to.</span>
<span id="cb35-530"><a href="#cb35-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-531"><a href="#cb35-531" aria-hidden="true" tabindex="-1"></a>Args:</span>
<span id="cb35-532"><a href="#cb35-532" aria-hidden="true" tabindex="-1"></a>*df*:Pandas DataFrame. This must contain columns with the names passed in as other arguments.</span>
<span id="cb35-533"><a href="#cb35-533" aria-hidden="true" tabindex="-1"></a>*col_name*:str. Name of column that will have values centered "col4"</span>
<span id="cb35-534"><a href="#cb35-534" aria-hidden="true" tabindex="-1"></a>*col_group*:list. Contains strings where each string is a column to be grouped on (<span class="co">[</span><span class="ot">"col1", "col2", "col3"</span><span class="co">]</span>)</span>
<span id="cb35-535"><a href="#cb35-535" aria-hidden="true" tabindex="-1"></a>*col_stand_name*:str. Name for new column contains centered values. ("colCentered")</span>
<span id="cb35-536"><a href="#cb35-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-537"><a href="#cb35-537" aria-hidden="true" tabindex="-1"></a>Impact: </span>
<span id="cb35-538"><a href="#cb35-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-539"><a href="#cb35-539" aria-hidden="true" tabindex="-1"></a>Returns df with an addition column for the centered data. Does not write any files.</span>
<span id="cb35-540"><a href="#cb35-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-541"><a href="#cb35-541" aria-hidden="true" tabindex="-1"></a>Example:</span>
<span id="cb35-542"><a href="#cb35-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-543"><a href="#cb35-543" aria-hidden="true" tabindex="-1"></a>Original df</span>
<span id="cb35-546"><a href="#cb35-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-547"><a href="#cb35-547" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-548"><a href="#cb35-548" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> center_column</span>
<span id="cb35-549"><a href="#cb35-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-550"><a href="#cb35-550" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb35-551"><a href="#cb35-551" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col1"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>],</span>
<span id="cb35-552"><a href="#cb35-552" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col2"</span>: [<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>]</span>
<span id="cb35-553"><a href="#cb35-553" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb35-554"><a href="#cb35-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-555"><a href="#cb35-555" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb35-556"><a href="#cb35-556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-557"><a href="#cb35-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-558"><a href="#cb35-558" aria-hidden="true" tabindex="-1"></a>Using the function</span>
<span id="cb35-559"><a href="#cb35-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-562"><a href="#cb35-562" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-563"><a href="#cb35-563" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-564"><a href="#cb35-564" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> center_column</span>
<span id="cb35-565"><a href="#cb35-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-566"><a href="#cb35-566" aria-hidden="true" tabindex="-1"></a>col_name <span class="op">=</span> <span class="st">"col1"</span></span>
<span id="cb35-567"><a href="#cb35-567" aria-hidden="true" tabindex="-1"></a>col_group <span class="op">=</span> [<span class="st">"col2"</span>]</span>
<span id="cb35-568"><a href="#cb35-568" aria-hidden="true" tabindex="-1"></a>col_stand_name <span class="op">=</span> <span class="st">"col1_centered"</span></span>
<span id="cb35-569"><a href="#cb35-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-570"><a href="#cb35-570" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> center_column(df, col_name, col_group, col_stand_name)</span>
<span id="cb35-571"><a href="#cb35-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-572"><a href="#cb35-572" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb35-573"><a href="#cb35-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-574"><a href="#cb35-574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-575"><a href="#cb35-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-576"><a href="#cb35-576" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*corr_and_plot(df, col1, col2, plot_file, n_digits)*</span>
<span id="cb35-577"><a href="#cb35-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-578"><a href="#cb35-578" aria-hidden="true" tabindex="-1"></a>Overview: Creates a plot using *matplotlib* library, saves it to a file and includes correlation between variables in plot.</span>
<span id="cb35-579"><a href="#cb35-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-580"><a href="#cb35-580" aria-hidden="true" tabindex="-1"></a>Args:</span>
<span id="cb35-581"><a href="#cb35-581" aria-hidden="true" tabindex="-1"></a>*df*:Pandas DataFrame. This must contain columns with the names passed in as other arguments.</span>
<span id="cb35-582"><a href="#cb35-582" aria-hidden="true" tabindex="-1"></a>*col1*:str. Name of column to plot on x-axis. ("col3")</span>
<span id="cb35-583"><a href="#cb35-583" aria-hidden="true" tabindex="-1"></a>*col2*:str. Name of column to plot on y-axis. ("col2")</span>
<span id="cb35-584"><a href="#cb35-584" aria-hidden="true" tabindex="-1"></a>*plot_file*:str. File name for .png of plot. ("plot.png")</span>
<span id="cb35-585"><a href="#cb35-585" aria-hidden="true" tabindex="-1"></a>*n_digits*:int. Integer for rounding correlation coefficent value (4)</span>
<span id="cb35-586"><a href="#cb35-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-587"><a href="#cb35-587" aria-hidden="true" tabindex="-1"></a>Impact:</span>
<span id="cb35-588"><a href="#cb35-588" aria-hidden="true" tabindex="-1"></a>Returns the plot from a matplotlib.pyplot. Also saves the plot as a file.</span>
<span id="cb35-589"><a href="#cb35-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-590"><a href="#cb35-590" aria-hidden="true" tabindex="-1"></a>Example:</span>
<span id="cb35-593"><a href="#cb35-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-594"><a href="#cb35-594" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> corr_and_plot, remove_outliers</span>
<span id="cb35-595"><a href="#cb35-595" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb35-596"><a href="#cb35-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-597"><a href="#cb35-597" aria-hidden="true" tabindex="-1"></a><span class="co">#prepping data for plot example</span></span>
<span id="cb35-598"><a href="#cb35-598" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'combined_farm_precip.csv'</span>)</span>
<span id="cb35-599"><a href="#cb35-599" aria-hidden="true" tabindex="-1"></a>col_name <span class="op">=</span> <span class="st">"yearly_avg"</span></span>
<span id="cb35-600"><a href="#cb35-600" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="op">-</span><span class="dv">50</span></span>
<span id="cb35-601"><a href="#cb35-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-602"><a href="#cb35-602" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> remove_outliers(df, col_name, threshold, lower <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb35-603"><a href="#cb35-603" aria-hidden="true" tabindex="-1"></a>colx <span class="op">=</span> <span class="st">"yearly_avg"</span></span>
<span id="cb35-604"><a href="#cb35-604" aria-hidden="true" tabindex="-1"></a>coly <span class="op">=</span> <span class="st">"Value of crop production"</span></span>
<span id="cb35-605"><a href="#cb35-605" aria-hidden="true" tabindex="-1"></a>plot_file <span class="op">=</span> <span class="ss">f"plot_</span><span class="sc">{</span>colx<span class="sc">}</span><span class="ss">_vs_</span><span class="sc">{</span>coly<span class="sc">}</span><span class="ss">.png"</span></span>
<span id="cb35-606"><a href="#cb35-606" aria-hidden="true" tabindex="-1"></a>n_digits <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb35-607"><a href="#cb35-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-608"><a href="#cb35-608" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> corr_and_plot(df, colx, coly, plot_file,n_digits)</span>
<span id="cb35-609"><a href="#cb35-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-610"><a href="#cb35-610" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb35-611"><a href="#cb35-611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-612"><a href="#cb35-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-613"><a href="#cb35-613" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*make_scatter_w_cat(df, colx, coly, colcat, plot_file)*</span>
<span id="cb35-614"><a href="#cb35-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-615"><a href="#cb35-615" aria-hidden="true" tabindex="-1"></a>Overview: Uses seaborn package to produce a scatterplot that colors the data by a categorical variable in the df.</span>
<span id="cb35-616"><a href="#cb35-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-617"><a href="#cb35-617" aria-hidden="true" tabindex="-1"></a>Args:</span>
<span id="cb35-618"><a href="#cb35-618" aria-hidden="true" tabindex="-1"></a>*df*:Pandas DataFrame. This must contain columns with the names passed in as other arguments.</span>
<span id="cb35-619"><a href="#cb35-619" aria-hidden="true" tabindex="-1"></a>*colx*:str. Name of column to plot on x-axis. ("col3")</span>
<span id="cb35-620"><a href="#cb35-620" aria-hidden="true" tabindex="-1"></a>*coly*:str. Name of column to plot on y-axis. ("col2")</span>
<span id="cb35-621"><a href="#cb35-621" aria-hidden="true" tabindex="-1"></a>*colcat*:str. Name of column containing categorical variable to group by.</span>
<span id="cb35-622"><a href="#cb35-622" aria-hidden="true" tabindex="-1"></a>*plot_file*:str. File name for .png of plot. ("plot.png")</span>
<span id="cb35-623"><a href="#cb35-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-624"><a href="#cb35-624" aria-hidden="true" tabindex="-1"></a>Impact:</span>
<span id="cb35-625"><a href="#cb35-625" aria-hidden="true" tabindex="-1"></a>Returns plot from matplotlib.pyplot. Also saves plot as a .png file.</span>
<span id="cb35-626"><a href="#cb35-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-627"><a href="#cb35-627" aria-hidden="true" tabindex="-1"></a>Example:</span>
<span id="cb35-628"><a href="#cb35-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-631"><a href="#cb35-631" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-632"><a href="#cb35-632" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-633"><a href="#cb35-633" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb35-634"><a href="#cb35-634" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> farm_precip_project <span class="im">import</span> make_scatter_w_cat</span>
<span id="cb35-635"><a href="#cb35-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-636"><a href="#cb35-636" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb35-637"><a href="#cb35-637" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col1"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>],</span>
<span id="cb35-638"><a href="#cb35-638" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col2"</span>: [<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"B"</span>,<span class="st">"B"</span>],</span>
<span id="cb35-639"><a href="#cb35-639" aria-hidden="true" tabindex="-1"></a>    <span class="st">"col3"</span>: [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]</span>
<span id="cb35-640"><a href="#cb35-640" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb35-641"><a href="#cb35-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-642"><a href="#cb35-642" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> make_scatter_w_cat(df, <span class="st">"col1"</span>, <span class="st">"col3"</span>, <span class="st">"col2"</span>, <span class="st">"example.png"</span>)</span>
<span id="cb35-643"><a href="#cb35-643" aria-hidden="true" tabindex="-1"></a>plt.show</span>
<span id="cb35-644"><a href="#cb35-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-645"><a href="#cb35-645" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>